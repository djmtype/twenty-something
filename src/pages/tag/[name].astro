---
import { metafy } from "@/utils/textConverter";

import { getTaxonomy } from "@/utils/taxonomyParser"
import taxonomyFilter from "@/utils/taxonomyFilter"

import BaseLayout from "@/layouts/BaseLayout.astro"
import FormattedDate from "@/components/FormattedDate.astro"


import { getCollection } from "astro:content"




export async function getStaticPaths() {

const tags = await getTaxonomy("postCollection", "tags");

return tags.map((tag) => {
  return {
    params: { name: tag },
    props: { tag },
  }
})
}

const { tag } = Astro.props
const metafyTag = await metafy(tag);


const posts = await getCollection(
  "postCollection",
  ({ data }) => data.status === "publish",
);

const filterByTags = taxonomyFilter(posts, "tags", tag!)
---

<BaseLayout title={metafyTag} description={`A list of entries with tag, ${metafyTag}`}>
  <h1>{`Tag: ${metafyTag}`}</h1>

  <ul>
    {
     filterByTags.map((p) => (
       <li><a href={`/${p.slug}`}>{p.data.title} - </a><FormattedDate date={p.data.date} /></li> 
      ))
    }
  </ul>
</BaseLayout>
