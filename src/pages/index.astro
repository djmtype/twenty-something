---
import config from "@/data/config.json"
import { Image } from "astro:assets"
import BaseLayout from "@/layouts/BaseLayout.astro"
import { sortByDate, filterByStatus } from "@/utils/postFunctions"
import { getCollection, type CollectionEntry } from "astro:content"
import Grid from "@/components/Grid.astro"
import Container from "@/components/Container.astro"
import Group from "@/components/Group.astro"

const postCollection = await getCollection("postCollection")

const sortedPosts = sortByDate(postCollection)

const filteredPosts = filterByStatus(sortedPosts)

const posts = filteredPosts.slice(0, config.blog.pageSize || 4)
---

<BaseLayout title={config.site.title} description={config.site.description}>
  <Group type="section">
    <Container>
      <div class="post-grid column-breakout">
        {
          posts.map((post) => (
            <div class="post-card">
              <figure class="post-card__figure">
                <Image
                  class="post-card__image"
                  src={post.data.thumbnail}
                  alt={post.data.thumbnailAlt}
                />
              </figure>
              <div class="post-card__content">
                <h2 set:html={post.data.title} />
                <p set:html={post.data.description} />
              </div>
            </div>
          ))
        }
      </div>
    </Container>
  </Group>
</BaseLayout>

<style lang="postcss">
  .post-grid {
    display: grid;
    gap: var(--gutter);
    align-items: start;
    @media (--lg-n-above) {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }

  .post-card {
    container: card / inline-size;
    display: grid;
    align-items: start;
    row-gap: var(--size-4);
  }

  .post-card:first-child {
    grid-column: 1/-1;
  }

  .post-card__figure {
    width: 100%;
    height: auto;
    
  }

  .post-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    aspect-ratio: 3/2;
    overflow: hidden;
    border-radius: var(--radius-3);
  }
.post-card__content {
  display: grid;
  align-items: baseline;
  row-gap: var(--size-3);
}
  .post-card__content h2 {
    font-size: var(--font-size-4);
  }

  .post-card__content p {
    color: var(--text-2);
    font-size: var(--font-size-1);
  }

  @container card (width >= 600px) {
    .post-card__image {
      aspect-ratio: 2.5/1;
    }
    .post-card__content h2 {
      font-size: var(--font-size-fluid-2);
    }
    .post-card__content p {
      font-size: var(--font-size-3);
    }
  }
</style>
