---
import type { ConfigObj } from "@/data/config.types"
import config from "@/data/config.json"

import PostItem from "@/components/PostItem.astro"
import BaseLayout from "@/layouts/BaseLayout.astro"
import { sortByDate, filterByStatus } from "@/utils/postFunctions"
import { getCollection } from "astro:content"

import Container from "@/components/Container.astro"
import Group from "@/components/Group.astro"

const postCollection = await getCollection("postCollection")

const sortedPosts = sortByDate(postCollection)

const filteredPosts = filterByStatus(sortedPosts)

const { 
  homeBlogPageSize: pageSize,
}: ConfigObj['settings'] = config.settings

const { 
  title: siteTitle,
  description: siteDescription,
}: ConfigObj['site'] = config.site

const posts = filteredPosts.slice(0, pageSize || 4)
---

<BaseLayout title={siteTitle} description={siteDescription}>
  <Group type="section">
    <Container>
      <div class="post-grid column-breakout">
        {posts.map((item, index) => 
        <PostItem post={item} index={index} />)
        }
      </div>
    </Container>
  </Group>
</BaseLayout>

<style>
  .post-grid {
    display: grid;
    gap: var(--gutter);
    row-gap: var(--size-fluid-5);
    align-items: start;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 30ch), 1fr));
    @media (--lg-n-above) {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }
</style>
